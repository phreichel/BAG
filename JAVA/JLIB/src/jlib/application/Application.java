//*************************************************************************************************
package jlib.application;
//*************************************************************************************************

import jlib.gui.GUI;
import jlib.gui.Padding;
import jlib.gui.Widget;
import jlib.gui.layout.Direction;
import jlib.gui.layout.GridFloat;
import jlib.gui.layout.Orientation;
import jlib.message.Message;
import jlib.message.Messager;
import jlib.platform.Platform;

//*************************************************************************************************
public class Application {

	//=============================================================================================
	private Messager messager;
	private Platform platform;
	private GUI gui;
	private boolean quit;
	//=============================================================================================

	//=============================================================================================
	public Application() {
		messager = new Messager();
		gui = new GUI();
		platform = new Platform(this, gui);
		quit = false;
	}
	//=============================================================================================

	//=============================================================================================
	protected void init() {
		messager.subscribe(
			this::receiveQuit,
			Message.CH_QUIT);
		platform.init();
		initUserInterface(gui);
	}
	//=============================================================================================

	//=============================================================================================
	public void initUserInterface(GUI gui) {
		
		var group = new Widget();
		group.position(20, 20);
		group.size(400, 300);
		for (int i=0; i<20; i++) {
			var child = new Widget();
			child.size(10+i*6, 10+i*3);
			group.insert(child);
		}
		var padding = new Padding(group);
		padding.padding(3, 3, 3, 3);
		var layout = new GridFloat();
		layout.gap(2, 2);
		layout.span(25);
		layout.align(
			Orientation.HORIZONTAL,
			Direction.REVERSE,
			Direction.REVERSE);
		padding.layout(layout);
		padding.doLayout();
		gui.insert(padding);

		messager.subscribe(
			gui::receive,
			Message.CH_INPUT);
		
	}
	//=============================================================================================
	
	//=============================================================================================
	protected void done() {
		platform.done();
	}
	//=============================================================================================

	//=============================================================================================
	private void loop() {
		quit = false;
		while (!quit) {
			messager.update();
			platform.update();
			Thread.yield();
		}
	}
	//=============================================================================================
	
	//=============================================================================================
	public void run() {
		this.init();
		this.loop();
		this.done();
	}
	//=============================================================================================

	//=============================================================================================
	public void title(String title) {
		platform.title(title);
	}
	//=============================================================================================

	//=============================================================================================
	public String title() {
		return platform.title();
	}
	//=============================================================================================
	
	//=============================================================================================
	public void post(Message message) {
		messager.post(message);
	}
	//=============================================================================================

	//=============================================================================================
	private void receiveQuit(Message msg) {
		quit = true;
	}
	//=============================================================================================
	
	
}
//*************************************************************************************************
