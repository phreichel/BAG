//*************************************************************************************************
package rp.application;
//*************************************************************************************************

//*************************************************************************************************
public class Clock {

	//=============================================================================================
	private static final int FRAME_COUNT = 60;
	private static final int SEGMENT_COUNT = 8;
	private static final long SEGMENT_LENGTH = 1000000000L / (FRAME_COUNT * SEGMENT_COUNT);
	//=============================================================================================
	
	//=============================================================================================
	private int segment;
	private long mark;
	private long target;
	//=============================================================================================
	
	//=============================================================================================
	public Clock() {}
	//=============================================================================================

	//=============================================================================================
	public void init() {
		segment = 0;
		mark = System.nanoTime();
		target = mark + SEGMENT_LENGTH;
	}
	//=============================================================================================

	//=============================================================================================
	public void update() {
		mark = System.nanoTime();
		target += SEGMENT_LENGTH;
		var delta = target-mark;
		if (delta < 0L) {
			throw new Throw("Clock Segment #" + segment + " time overflow by " + (-delta) + "ns");
		}
		try {
			Thread.sleep(delta);
			segment = (segment+1) % SEGMENT_COUNT;
		} catch (InterruptedException e) {
			throw new Throw(e);
		}
	}
	//=============================================================================================

	//=============================================================================================
	public int segment() {
		return segment;
	}
	//=============================================================================================
	
}
//*************************************************************************************************
